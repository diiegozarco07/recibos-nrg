<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador Recibos NRG</title>
    <style>
        /* Estilos de Interfaz */
        body { font-family: 'Arial', sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; }
        #ui-panel { 
            background: #fff; padding: 25px; border-radius: 10px; margin: 0 auto 30px; 
            max-width: 900px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 1px solid #ddd;
        }
        
        /* Grid del Formulario */
        .input-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 15px; }
        
        label { font-size: 12px; font-weight: bold; color: #555; margin-bottom: 5px; display: block; }
        input[type="text"], input[type="number"], select, textarea { 
            width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; 
            box-sizing: border-box; font-size: 14px; transition: border 0.3s;
        }
        input:focus, textarea:focus { border-color: #000; outline: none; }
        input:disabled { background-color: #eee; color: #888; }
        
        button.btn-print { 
            background: #111; color: #fff; border: none; padding: 15px; cursor: pointer; 
            width: 100%; font-weight: bold; border-radius: 5px; margin-top: 20px; font-size: 16px;
            text-transform: uppercase; letter-spacing: 1px;
        }
        button.btn-print:hover { background: #333; }

        /* Estilo para items individuales */
        .individual-item { 
            margin-bottom: 20px; border-left: 5px solid #222; padding-left: 20px; 
            background: #fff; padding: 15px; border-radius: 0 8px 8px 0; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .individual-header { 
            font-size: 13px; font-weight: 800; color: #222; margin-bottom: 10px; 
            text-transform: uppercase; border-bottom: 2px solid #eee; padding-bottom: 5px; display: block;
        }
        .grid-individual { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 10px; }

        /* Checkbox bonito */
        .check-container { display: flex; align-items: center; margin-top: 5px; }
        .check-container input { width: 18px; height: 18px; margin-right: 8px; cursor: pointer; accent-color: #000; }
        .check-text { font-size: 13px; font-weight: bold; color: #333; cursor: pointer; }

        /* Contenedor de Opciones Avanzadas */
        #seccion-avanzada {
            margin-top: 20px; background: #f8f9fa; padding: 20px; 
            border-radius: 8px; border: 1px solid #e0e0e0; display: none; /* OCULTO POR DEFECTO */
        }

        #print-area { display: flex; flex-direction: column; align-items: center; }

        /* Estructura del Recibo */
        .recibo-unit { 
            background: #fff; width: 21cm; height: 12.5cm; padding: 0.8cm 1.5cm; 
            margin-bottom: 0; border: 1px solid #eee; box-sizing: border-box; 
            position: relative; overflow: hidden;
        }

        /* Línea de recorte */
        .recibo-unit:nth-child(odd):not(:last-child) { border-bottom: 2px dashed #aaa; }
        .recibo-unit:nth-child(odd):not(:last-child)::after {
            content: '✂-------------------------------------------------------------------------------------------------';
            position: absolute; bottom: -10px; left: 0; width: 100%; text-align: center; color: #aaa; font-size: 14px; letter-spacing: 2px;
        }

        /* Salto de página */
        .recibo-unit:nth-child(even) { page-break-after: always; }

        .header { width: 100%; margin-bottom: 10px; }
        .logo-box img { max-height: 75px; max-width: 210px; object-fit: contain; }
        .info-box { text-align: right; font-size: 9px; line-height: 1.1; color: #333; }
        
        .tabla-datos { width: 100%; border-collapse: collapse; }
        .tabla-datos td { padding: 6px 5px; border-bottom: 1px solid #eee; font-size: 13px; }
        .label { font-weight: bold; width: 30%; color: #000; }
        .valor { border-bottom: 1px solid #999; min-height: 16px; display: inline-block; width: 95%; text-transform: uppercase; }

        .firmas { margin-top: 35px; display: flex; justify-content: space-between; text-align: center; }
        .firma-linea { border-top: 1.5px solid #000; width: 45%; padding-top: 5px; font-size: 10px; font-weight: bold; }

        @media print {
            @page { margin: 0; }
            #ui-panel { display: none; }
            body { background: #fff; padding: 0; margin: 0; }
            .recibo-unit { border-left: none; border-right: none; border-top: none; }
        }
    </style>
</head>
<body>

<div id="ui-panel">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h3 style="margin:0;">Generador NRG - v5.1 Final</h3>
    </div>

    <div class="input-row">
        <div><label>Empresa:</label>
            <select id="emp" onchange="renderRecibos()">
                <option value="solar">NRG Solar</option>
                <option value="ing">NRG Ingeniería</option>
                <option value="mont">NRG Montajes & Maquinaria</option>
            </select>
        </div>
        <div><label>Copias:</label>
            <select id="cantidad" onchange="controlarVisibilidadAvanzada()">
                <option value="1">1 Recibo</option>
                <option value="2">2 Recibos (1 hoja)</option>
                <option value="4">4 Recibos (2 hojas)</option>
            </select>
        </div>
        <div>
            <label>Fecha:</label>
            <input type="text" id="iF" oninput="sync()" placeholder="DD/MM/AAAA">
            <div class="check-container" onclick="document.getElementById('checkFecha').click()">
                <input type="checkbox" id="checkFecha" onchange="toggleFechaHoy(event)"> 
                <span class="check-text">Usar fecha de hoy</span>
            </div>
        </div>
    </div>
    
    <div id="seccion-avanzada" style="display: none;">
        <div style="margin-bottom: 15px; border-bottom: 1px solid #ddd; padding-bottom: 10px;">
            <div class="check-container" onclick="document.getElementById('checkIndividual').click()">
                <input type="checkbox" id="checkIndividual" onchange="actualizarInterfazIndividual()">
                <span class="check-text" style="font-size:14px;">Activar datos diferentes para cada recibo</span>
            </div>
        </div>
        <div id="contenedor-dinamico"></div>
    </div>

    <div id="inputs-globales">
        <div class="input-row">
            <div style="grid-column: span 3;"><label>Nombre Cliente (Global):</label><input type="text" id="iN_Global" oninput="sync()"></div>
        </div>
        <div class="input-row">
            <div><label>Monto $ (Global):</label><input type="number" id="iM_Global" step="0.01" oninput="convertirMontoGlobal(); sync();"></div>
            <div style="grid-column: span 2;"><label>Cantidad con Letra:</label><input type="text" id="iL_Global" oninput="sync()"></div>
        </div>
        <div><label>Concepto (Global):</label><textarea id="iC_Global" oninput="sync()" style="height: 50px;"></textarea></div>
    </div>

    <button class="btn-print" onclick="window.print()">IMPRIMIR RECIBOS</button>
</div>

<div id="print-area"></div>

<script>
    // --- CONFIGURACIÓN DE IMÁGENES ---
    const logos = {
        solar: 'solar.png',       
        ing: 'ingenieria.png',    
        mont: 'montajes.png'    
    };

    const nombresEmpresa = {
        solar: 'NRG SOLAR. ',
        ing: 'NRG. ',
        mont: 'MONTAJES. '
    };

    // --- LÓGICA DE VISIBILIDAD (1 vs Varios) ---
    function controlarVisibilidadAvanzada() {
        const cant = parseInt(document.getElementById('cantidad').value);
        const seccionAvanzada = document.getElementById('seccion-avanzada');
        const checkIndividual = document.getElementById('checkIndividual');

        if (cant === 1) {
            // FUERZA BRUTA: Si es 1, ocultar la caja avanzada y desmarcar el check
            seccionAvanzada.style.display = 'none';
            checkIndividual.checked = false; 
        } else {
            // Si son más de 1, mostrar la caja avanzada
            seccionAvanzada.style.display = 'block';
        }
        // Actualizar la interfaz para reflejar si está marcado o no (o forzado a no estarlo)
        actualizarInterfazIndividual(); 
    }

    // --- LÓGICA DE FECHA (Check) ---
    function toggleFechaHoy(e) {
        if(e) e.stopPropagation(); 
        const check = document.getElementById('checkFecha');
        const inputFecha = document.getElementById('iF');
        
        if (check.checked) {
            const meses = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
            const hoy = new Date();
            const texto = `${hoy.getDate()} de ${meses[hoy.getMonth()]} de ${hoy.getFullYear()}`;
            inputFecha.value = texto;
            inputFecha.disabled = true; 
        } else {
            inputFecha.value = "";
            inputFecha.disabled = false;
        }
        sync();
    }

    // --- LÓGICA INTERFAZ INDIVIDUAL ---
    function actualizarInterfazIndividual() {
        const cant = parseInt(document.getElementById('cantidad').value);
        const esIndividual = document.getElementById('checkIndividual').checked;
        const contenedor = document.getElementById('contenedor-dinamico');
        const globales = document.getElementById('inputs-globales');
        
        contenedor.innerHTML = ''; 

        // Solo activar modo individual si el check está marcado Y hay más de 1 copia
        if (esIndividual && cant > 1) {
            globales.style.display = 'none'; // Ocultar global
            
            for (let i = 0; i < cant; i++) {
                contenedor.innerHTML += `
                    <div class="individual-item">
                        <span class="individual-header">Datos Recibo #${i + 1}</span>
                        <div style="margin-bottom: 10px;">
                            <label>Nombre Cliente:</label>
                            <input type="text" id="iN_${i}" oninput="sync()" placeholder="Cliente...">
                        </div>
                        <div class="grid-individual">
                            <div>
                                <label>Monto $:</label>
                                <input type="number" id="iM_${i}" step="0.01" oninput="convertirMontoIndividual(${i}); sync();">
                            </div>
                            <div style="grid-column: span 2;">
                                <label>Cantidad con Letra (Auto):</label>
                                <input type="text" id="iL_${i}" oninput="sync()">
                            </div>
                        </div>
                        <div>
                            <label>Concepto:</label>
                            <textarea id="iC_${i}" oninput="sync()" style="height: 35px;"></textarea>
                        </div>
                    </div>
                `;
            }
        } else {
            // MODO GLOBAL (1 copia o checkbox desmarcado)
            globales.style.display = 'block'; 
        }
        renderRecibos(); 
    }

    // --- CONVERTIDOR NUMEROS ---
    function numeroALetras(num) {
        const unidades = ["", "UN", "DOS", "TRES", "CUATRO", "CINCO", "SEIS", "SIETE", "OCHO", "NUEVE"];
        const decenas = ["DIEZ", "ONCE", "DOCE", "TRECE", "CATORCE", "QUINCE", "DIECISEIS", "DIECISIETE", "DIECIOCHO", "DIECINUEVE"];
        const decenas_propias = ["", "", "VEINTE", "TREINTA", "CUARENTA", "CINCUENTA", "SESENTA", "SETENTA", "OCHENTA", "NOVENTA"];
        const centenas = ["", "CIENTO", "DOSCIENTOS", "TRESCIENTOS", "CUATROCIENTOS", "QUINIENTOS", "SEISCIENTOS", "SETENCIENTOS", "OCHOCIENTOS", "NOVECIENTOS"];

        function convertirGrupo(n) {
            let output = "";
            if (n === 100) return "CIEN ";
            if (n > 99) { output += centenas[Math.floor(n / 100)] + " "; n %= 100; }
            if (n > 19) { output += decenas_propias[Math.floor(n / 10)] + (n % 10 !== 0 ? " Y " : " "); n %= 10; }
            if (n > 9) { output += decenas[n - 10] + " "; n = 0; }
            if (n > 0) { output += unidades[n] + " "; }
            return output;
        }

        if (num === 0 || num === "") return "";
        let [entero, decimal] = parseFloat(num).toFixed(2).split('.');
        let nEntero = parseInt(entero);
        let letras = "";

        if (nEntero >= 1000000) {
            let millon = Math.floor(nEntero / 1000000);
            letras += (millon === 1 ? "UN MILLON " : convertirGrupo(millon) + " MILLONES ");
            nEntero %= 1000000;
        }
        if (nEntero >= 1000) {
            let mil = Math.floor(nEntero / 1000);
            letras += (mil === 1 ? "MIL " : convertirGrupo(mil) + " MIL ");
            nEntero %= 1000;
        }
        letras += convertirGrupo(nEntero);
        return `${letras}PESOS ${decimal}/100 M.N.`.replace(/\s+/g, ' ');
    }

    function convertirMontoGlobal() {
        const monto = document.getElementById('iM_Global').value;
        if (monto) document.getElementById('iL_Global').value = numeroALetras(monto);
    }

    function convertirMontoIndividual(idx) {
        const monto = document.getElementById('iM_' + idx).value;
        if (monto) document.getElementById('iL_' + idx).value = numeroALetras(monto);
    }

    // --- RENDERIZADO VISUAL ---
    function renderRecibos() {
        const cant = parseInt(document.getElementById('cantidad').value);
        const container = document.getElementById('print-area');
        const empValue = document.getElementById('emp').value;
        const etiquetaEmpresa = nombresEmpresa[empValue];
        
        container.innerHTML = ''; 

        for (let i = 0; i < cant; i++) {
            container.innerHTML += `
                <div class="recibo-unit" id="recibo-${i}">
                    <table class="header" width="100%">
                        <tr>
                            <td class="logo-box">
                                <div style="font-weight:bold; font-size:16px; margin-bottom:5px;">RECIBO DE PAGO</div>
                                <img src="${logos[empValue]}">
                            </td>
                            <td class="info-box">
                                <strong>${etiquetaEmpresa}NRG Ingeniería Electromecánica S.A. de C.V.</strong><br>
                                NIE1808155W9<br>
                                Calle Libramiento-Sur Poniente #376 Campestre Italiana CP. 76080<br>
                                Querétaro, Qro., Tel (442) 251 1682
                            </td>
                        </tr>
                    </table>
                    <table class="tabla-datos">
                        <tr><td class="label">Forma de pago:</td><td><span class="valor">De contado</span></td></tr>
                        <tr><td class="label">Fecha:</td><td><span class="valor oF"></span></td></tr>
                        <tr><td class="label">Nombre:</td><td><span class="valor oN"></span></td></tr>
                        <tr><td class="label">RFC del Cliente:</td><td><span class="valor">N/A</span></td></tr>
                        <tr><td class="label">Asesor Comercial:</td><td><span class="valor">N/A</span></td></tr>
                        <tr><td class="label">Se recibe la cantidad de:</td><td><span class="valor"><span class="oM"></span> (MXN)</span></td></tr>
                        <tr><td class="label">Por concepto de:</td><td><span class="valor oC"></span></td></tr>
                        <tr><td class="label">Cantidad con letra:</td><td><span class="valor oL"></span></td></tr>
                    </table>
                    <div class="firmas">
                        <div class="firma-linea">Nombre y firma de quien entrega</div>
                        <div class="firma-linea">Nombre y firma de quien recibe</div>
                    </div>
                </div>
            `;
        }
        sync(); 
    }

    function sync() {
        // 1. Fecha siempre común
        const fechaVal = document.getElementById('iF').value;
        const recibos = document.getElementsByClassName('recibo-unit');
        for(let i=0; i < recibos.length; i++) recibos[i].querySelector('.oF').innerText = fechaVal;

        // 2. Datos (Globales vs Individuales)
        const esIndividual = document.getElementById('checkIndividual').checked;
        const cant = parseInt(document.getElementById('cantidad').value);
        
        if (!esIndividual || cant === 1) {
            // MODO GLOBAL
            const n = document.getElementById('iN_Global').value;
            const m = document.getElementById('iM_Global').value;
            const l = document.getElementById('iL_Global').value;
            const c = document.getElementById('iC_Global').value;

            for(let i=0; i < recibos.length; i++) {
                recibos[i].querySelector('.oN').innerText = n;
                recibos[i].querySelector('.oM').innerText = m;
                recibos[i].querySelector('.oL').innerText = l;
                recibos[i].querySelector('.oC').innerText = c;
            }
        } else {
            // MODO INDIVIDUAL
            for(let i=0; i < recibos.length; i++) {
                const in_cl = document.getElementById('iN_' + i);
                const im = document.getElementById('iM_' + i);
                const il = document.getElementById('iL_' + i);
                const ic = document.getElementById('iC_' + i);
                
                if(in_cl) recibos[i].querySelector('.oN').innerText = in_cl.value;
                if(im) recibos[i].querySelector('.oM').innerText = im.value;
                if(il) recibos[i].querySelector('.oL').innerText = il.value;
                if(ic) recibos[i].querySelector('.oC').innerText = ic.value;
            }
        }
    }

    // Inicializar
    window.onload = function() {
        controlarVisibilidadAvanzada();
    };
</script>
</body>
</html>
